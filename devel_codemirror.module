<?php

/**
 * @file
 * Contains devel_codemirror.module.
 */

/**
 * Implements hook_form_FORM_ID_alter().
 */
function devel_codemirror_form_devel_execute_form_alter(&$form) {
  $form['#attached']['library'][] = 'devel_codemirror/codemirror';
  $form['#attached']['library'][] = 'devel_codemirror/devel';

  $config = \Drupal::config('devel_codemirror.settings')->get();
  $form['#attached']['drupalSettings']['devel']['codemirror'] = $config;
}

/**
 * Implements hook_library_info_alter().
 */
function devel_codemirror_library_info_alter(&$libraries, $extension) {
  if ($extension == 'devel_codemirror' && isset($libraries['codemirror'])) {
    $config = \Drupal::config('devel_codemirror.settings')->get();

    if ($config['theme'] != 'default') {
      $libraries['codemirror']['css']['theme']['codemirror/theme/' . $config['theme'] . '.css'] = [];
    }

    if ($config['matchBrackets']) {
      $libraries['codemirror']['js']['codemirror/addon/edit/matchbrackets.js'] = [];
    }

    if ($config['autoCloseBrackets']) {
      $libraries['codemirror']['js']['codemirror/addon/edit/closebrackets.js'] = [];
    }

    if ($config['styleActiveLine']) {
      $libraries['codemirror']['js']['codemirror/addon/selection/active-line.js'] = [];
    }
  }
}
